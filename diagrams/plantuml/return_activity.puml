@startuml
|Thủ thư (Admin)|
start
:Quét mã sách hoặc ID người dùng;
: Tìm phiếu mượn tương ứng;
|Hệ thống (Web)|
:Hiển thị thông tin phiếu mượn;
|Cơ sở dữ liệu (MySQL)|
:UPDATE borrow SET return_date = NOW(), return_condition = '...', return_notes = '...' WHERE id = ...;
:UPDATE book SET available_quantity = available_quantity + 1 WHERE id = ...;
:INSERT INTO audit (action='return', details='Đã trả sách...');
|Hệ thống (Web)|
:Thông báo "Trả sách hoàn tất";
if (Cần backup dữ liệu?) then (Có - định kỳ)
  |Cơ sở dữ liệu (MySQL)|
  :INSERT INTO borrow_backup SELECT * FROM borrow WHERE return_date IS NOT NULL;
  :DELETE FROM borrow WHERE return_date IS NOT NULL;
endif
stop
@enduml
