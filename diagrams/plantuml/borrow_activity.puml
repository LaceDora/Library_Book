@startuml
|Người dùng (User)|
start
:Đăng nhập hệ thống;
: Tìm kiếm sách;
: Xem chi tiết sách;
: Nhấn nút "Mượn sách";
|Hệ thống (Web)|
:Kiểm tra trạng thái user;
if (Tài khoản bị khoá?) then (Yes)
  :Hiển thị "Tài khoản bị khoá";
  stop
else (No)
  :Kiểm tra số lượng sách;
endif
|Cơ sở dữ liệu (MySQL)|
note right
  SELECT available_quantity FROM book WHERE id = ...
end note
if (available_quantity > 0) then (Yes)
  :Xử lý giao dịch mượn;
  -> INSERT INTO borrow (user_id, book_id, book_title, borrow_date)
  -> UPDATE book SET available_quantity = available_quantity - 1
  -> INSERT INTO audit (action='borrow', ...)
  :Thông báo "Mượn thành công";
else (No)
  :Thông báo "Sách tạm hết";
endif
:Nhận thông báo;
stop
@enduml
