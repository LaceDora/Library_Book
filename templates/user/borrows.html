{% extends "user/base.html" %}
{#
templates/borrows.html

Hiển thị lịch sử mượn của người dùng hiện tại.
- `records` là danh sách Borrow objects (hoặc với snapshot `book_title`).
- Nếu borrow chưa trả, hiển thị form POST để gọi route trả sách (book_bp.return_book).
#}
{% block content %}

<div style="min-height: 75vh;">
  <h3 class="text-center text-primary mb-4">Lịch sử mượn sách</h3>

  {% if records %}
  <table class="table table-striped table-bordered align-middle">
    <thead class="table-primary text-center">
      <tr>
        <th>Tên sách</th>
        <th>Ngày mượn</th>
        <th>Ngày trả</th>
        <th>Trạng thái</th>
      </tr>
    </thead>
    <tbody>
      {% for r in records %}
      <tr class="text-center">
        <td>{{ r.book_title if r.book_title else (r.book.title if r.book else "Đã xóa") }}</td>
        <td>{{ r.borrow_date.strftime("%d/%m/%Y %H:%M") }}</td>
        <td>
          {% if r.return_date %}
          {{ r.return_date.strftime("%d/%m/%Y %H:%M") }}
          {% else %}
          <span class="text-muted">Chưa trả</span>
          {% endif %}
        </td>
        <td>
          {% if r.status == 'pending' %}
          <span class="badge bg-warning text-dark">Chờ duyệt</span>
          {% elif r.status == 'rejected' %}
          <span class="badge bg-danger">Từ chối</span>
          {% elif r.return_date %}
          <span class="badge bg-success">Đã trả</span>
          {% else %}
          <span class="badge bg-primary">Đã duyệt</span>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="text-center text-muted">Bạn chưa mượn sách nào.</p>
  {% endif %}
</div>

{% endblock %}