{% extends "user/base.html" %}

{% block content %}
<style>
  .input-with-icon {
    position: relative;
  }

  .input-with-icon .icon {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #6c757d;
    z-index: 2;
  }

  .input-with-icon .form-control {
    padding-left: 2.5rem;
  }

  .auth-brand .logo {
    width: 64px;
    height: 64px;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    overflow: hidden;
    margin-right: 12px;
    display: inline-block;
  }

  .auth-brand .auth-logo {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }
</style>

<div class="auth-page">
  <div class="auth-card">
    <div class="auth-brand d-flex align-items-center">
      <div class="logo">
        <img src="{{ url_for('static', filename='uploads/logo.jpg') }}" alt="Logo" class="auth-logo">
      </div>
      <div>
        <div class="text-success fw-bold">Thư viện</div>
        <div class="small text-muted">Khôi phục mật khẩu</div>
      </div>
    </div>

    <h3 class="mb-3">Quên mật khẩu</h3>
    <p class="text-muted mb-4">
      Nhập MSSV/MSCB hoặc email của tài khoản cần khôi phục. Mã xác nhận sẽ được gửi đến email đã đăng ký của tài khoản
      đó.
    </p>

    <form method="POST" action="{{ url_for('auth_bp.forgot_password') }}" class="mb-3">
      {% if is_logged_in %}
      <div class="alert alert-info small">
        <i class="bi bi-info-circle"></i> Bạn đang yêu cầu đặt lại mật khẩu cho tài khoản hiện tại.
      </div>
      <div class="mb-3 input-with-icon">
        <span class="icon"><i class="bi bi-person-circle"></i></span>
        <input type="text" class="form-control" value="{{ current_user.student_staff_id }} ({{ current_user.email }})"
          disabled readonly>
        <input type="hidden" name="identifier" value="{{ current_user.student_staff_id }}">
      </div>
      {% else %}
      <div class="mb-3 input-with-icon">
        <span class="icon"><i class="bi bi-person-circle"></i></span>
        <input type="text" name="identifier" id="identifier" class="form-control"
          placeholder="MSSV/MSCB hoặc Email tài khoản" required autocomplete="username">
      </div>
      {% endif %}

      <button type="submit" class="btn btn-success w-100 mb-3">Gửi mã xác nhận</button>
    </form>

    <div class="d-flex justify-content-between small-link">
      {% if request.args.get('from') == 'profile' %}
      <a href="{{ url_for('user_bp.profile') }}">Quay lại trang profile</a>
      {% else %}
      <a href="{{ url_for('auth_bp.login') }}">Quay lại đăng nhập</a>
      {% endif %}
      <a href="{{ url_for('auth_bp.register') }}">Đăng ký tài khoản</a>
    </div>

    {% if admin_email or admin_phone %}
    <div class="alert alert-info mt-4">
      <h6 class="alert-heading"><i class="bi bi-info-circle"></i> Cần hỗ trợ?</h6>
      <p class="mb-0 small">
        Nếu bạn không thể khôi phục mật khẩu, vui lòng liên hệ thủ thư:
        {% if admin_email %}<br>Email: <strong>{{ admin_email }}</strong>{% endif %}
        {% if admin_phone %}<br>SĐT: <strong>{{ admin_phone }}</strong>{% endif %}
      </p>
    </div>
    {% endif %}
  </div>
</div>

{% endblock %}