{% extends "user/base.html" %}
{#
templates/login.html

Form đăng nhập: trường `login` chứa MSSV/MSCB, `password` chứa mật khẩu.
Sử dụng JS toggle để hiển thị/ẩn mật khẩu.
#}
{% block content %}

<style>
  .input-with-icon {
    position: relative;
  }

  .input-with-icon .icon {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #6c757d;
    z-index: 2;
  }

  .input-with-icon .password-toggle {
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    padding: 0.375rem 0.75rem;
    color: #6c757d;
    background: none;
    border: none;
    cursor: pointer;
  }

  .input-with-icon .form-control {
    padding-left: 2.5rem;
    padding-right: 2.5rem;
  }
</style>

{# Load reCAPTCHA script only when site key is configured #}
{%- if config['RECAPTCHA_SITE_KEY'] %}
<script src="https://www.google.com/recaptcha/api.js" async defer></script>
{%- endif %}

<script>
  function togglePassword(inputId, button) {
    var input = document.getElementById(inputId);
    var icon = button.querySelector('i');

    if (input.type === 'password') {
      input.type = 'text';
      icon.classList.remove('bi-eye-fill');
      icon.classList.add('bi-eye-slash-fill');
    } else {
      input.type = 'password';
      icon.classList.remove('bi-eye-slash-fill');
      icon.classList.add('bi-eye-fill');
    }
  }
</script>

<div class="auth-page">
  <div class="auth-card">
    <div class="auth-brand d-flex align-items-center">
      <div class="logo">
        <img src="{{ url_for('static', filename='uploads/logo.jpg') }}" alt="Logo" class="auth-logo">
      </div>
      <div>
        <div class="text-primary fw-bold">Thư viện</div>
        <div class="small text-muted">Đăng nhập để mượn sách</div>
      </div>
    </div>

    <h3 class="mb-3">Đăng nhập</h3>
    <!-- DEV banner: hiện khi template mới được phục vụ -->
    <!-- DEV banner removed -->

    <form method="POST" action="{{ url_for('auth_bp.login') }}" class="mb-3">
      <div class="mb-3 input-with-icon">
        <span class="icon"><i class="bi bi-person-circle"></i></span>
        <input type="text" name="login" id="login" class="form-control" placeholder="MSSV/MSCB hoặc Email" required>
      </div>

      <div class="mb-3 input-with-icon">
        <span class="icon"><i class="bi bi-lock-fill"></i></span>
        <input type="password" name="password" id="password" class="form-control" placeholder="Mật khẩu" required>
        <button type="button" class="btn btn-link password-toggle" onclick="togglePassword('password', this)"
          aria-label="Toggle password visibility">
          <i class="bi bi-eye-fill"></i>
        </button>
      </div>

      {%- if config['RECAPTCHA_SITE_KEY'] %}
      <div class="mb-3 text-center">
        <div class="g-recaptcha" data-sitekey="{{ config['RECAPTCHA_SITE_KEY'] }}"></div>
      </div>
      {%- endif %}

      <button type="submit" class="btn btn-light border w-100 btn-auth-main">Đăng nhập</button>
    </form>
    <!-- separator with OR -->
    <div class="oauth-separator my-3">
      <span>hoặc</span>
    </div>

    <div class="mb-3 text-center">
      <a href="{{ url_for('google_oauth_bp.login_google') }}" class="btn btn-google w-100">
        <!-- Google SVG icon -->
        <svg width="18" height="18" viewBox="0 0 18 18" style="margin-right:8px;vertical-align:middle"
          xmlns="http://www.w3.org/2000/svg">
          <g fill="none" fill-rule="evenodd">
            <path
              d="M17.64 9.2c0-.63-.06-1.24-.17-1.82H9v3.44h4.84c-.21 1.12-.84 2.07-1.8 2.7v2.24h2.9c1.7-1.56 2.7-3.87 2.7-6.56z"
              fill="#4285F4" />
            <path
              d="M9 18c2.43 0 4.47-.8 5.96-2.17l-2.9-2.24c-.8.54-1.82.86-3.06.86-2.35 0-4.34-1.58-5.05-3.7H.98v2.33C2.46 15.9 5.5 18 9 18z"
              fill="#34A853" />
            <path
              d="M3.95 10.75A5.4 5.4 0 0 1 3.6 9c0-.62.1-1.22.28-1.75V4.92H.98A8.99 8.99 0 0 0 0 9c0 1.45.35 2.82.98 4.08l2.97-2.33z"
              fill="#FBBC05" />
            <path
              d="M9 3.58c1.32 0 2.51.45 3.44 1.34l2.58-2.58C13.45.98 11.42 0 9 0 5.5 0 2.46 2.1.98 4.92l2.97 2.33C4.66 5.18 6.65 3.58 9 3.58z"
              fill="#EA4335" />
          </g>
        </svg>
        <span style="vertical-align:middle">Đăng nhập bằng Google</span>
      </a>
    </div>
    <div class="d-flex justify-content-between small-link">
      <a href="{{ url_for('auth_bp.register') }}">Chưa có tài khoản? Đăng ký</a>
      <a href="{{ url_for('auth_bp.forgot_password', from='login') }}" class="text-muted">Quên mật khẩu?</a>
    </div>
  </div>
</div>



{% endblock %}

<style>
  /* Styling for auth buttons and separator */
  /* Make main login button visually match sample: white background, dark text, subtle border */
  .btn-auth-main {
    padding: .6rem 1rem;
    font-weight: 700;
    color: #ffffff !important;
    background: #0d6efd !important;
    /* blue */
    border: 1px solid #0d6efd !important;
    box-shadow: 0 4px 14px rgba(13, 110, 253, 0.12) !important;
    border-radius: 10px !important;
  }

  .btn-auth-main:hover {
    background: #0b5ed7 !important;
    border-color: #0b5ed7 !important;
  }

  .auth-action {
    max-width: 380px;
    margin: 0 auto
  }

  .btn-google {
    background: #fff !important;
    border: 1px solid #cfcfcf !important;
    /* gray frame as requested */
    color: #222 !important;
    padding: .55rem 1rem;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.03);
    border-radius: 10px;
  }

  .btn-google:hover {
    background: #f8f9fa;
    text-decoration: none
  }

  .oauth-separator {
    display: flex;
    align-items: center;
    text-align: center;
    gap: 0.5rem
  }

  .oauth-separator:before,
  .oauth-separator:after {
    content: "";
    flex: 1;
    height: 1px;
    background: #e9ecef;
    display: block
  }

  .oauth-separator span {
    color: #6c757d;
    font-weight: 600;
    padding: 0 .5rem
  }

  /* Ensure both buttons same width visually and centered */
  .auth-card .btn {
    max-width: 380px;
    display: block;
    margin: 0 auto;
  }
</style>