{% extends "admin/base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2>Quản lý sách</h2>
  <a href="{{ url_for('admin_bp.add_book') }}" class="btn btn-success">
    <i class="bi bi-plus-circle"></i> Thêm sách mới
  </a>
</div>

<div class="card shadow">
  <div class="card-body">
    <!-- Search form -->
    <form method="GET" class="mb-4">
      <div class="input-group">
        <input type="text" name="search" class="form-control" placeholder="Tìm kiếm theo tên sách hoặc tác giả..." 
               value="{{ request.args.get('search', '') }}">
        <button class="btn btn-primary" type="submit">Tìm kiếm</button>
  <a href="{{ url_for('admin_bp.books') }}" class="btn btn-outline-secondary">Reset</a>
      </div>
    </form>

    <!-- Books table -->
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>ID</th>
            <th>Tên sách</th>
            <th>Tác giả</th>
            <th>Thể loại</th>
            <th>Số lượng</th>
            <th>Trạng thái</th>
            <th>Hành động</th>
          </tr>
        </thead>
        <tbody>
          {% for book in books.items %}
          <tr>
            <td>{{ book.id }}</td>
            <td>{{ book.title }}</td>
            <td>{{ book.author }}</td>
            <td>{{ book.category or 'Chưa phân loại' }}</td>
            <td>{{ book.quantity }}</td>
            <td>
              {% if book.is_active %}
              <span class="badge bg-success">Đang hoạt động</span>
              {% else %}
              <span class="badge bg-danger">Đã ẩn</span>
              {% endif %}
            </td>
            <td>
              <div class="btn-group" role="group">
                <a href="{{ url_for('admin_bp.edit_book', book_id=book.id) }}" class="btn btn-sm btn-warning">
                  <i class="bi bi-pencil"></i>
                </a>
                <a href="{{ url_for('admin_bp.delete_book', book_id=book.id) }}" 
                   class="btn btn-sm btn-danger"
                   onclick="return confirm('Xác nhận xóa sách này?')">
                  <i class="bi bi-trash"></i>
                </a>
              </div>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="7" class="text-center">Không có sách nào.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    {% if books.pages > 1 %}
    <nav class="mt-3">
      <ul class="pagination justify-content-center">
        {% if books.has_prev %}
        <li class="page-item">
          <a class="page-link" href="{{ url_for('admin_bp.books', page=books.prev_num) }}">Trước</a>
        </li>
        {% else %}
        <li class="page-item disabled">
          <span class="page-link">Trước</span>
        </li>
        {% endif %}

        <li class="page-item disabled">
          <span class="page-link">Trang {{ books.page }} / {{ books.pages }}</span>
        </li>

        {% if books.has_next %}
        <li class="page-item">
          <a class="page-link" href="{{ url_for('admin_bp.books', page=books.next_num) }}">Sau</a>
        </li>
        {% else %}
        <li class="page-item disabled">
          <span class="page-link">Sau</span>
        </li>
        {% endif %}
      </ul>
    </nav>
    {% endif %}
  </div>
</div>
{% endblock %}